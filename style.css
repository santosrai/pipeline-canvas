@import 'reactflow/dist/style.css';

/* ============================================================================
   Pipeline Canvas - Scoped Theme System
   
   This file provides isolated theming for the pipeline-canvas library.
   All CSS variables use the `--pc-` prefix to avoid conflicts with parent apps.
   ============================================================================ */

/* ============================================================================
   Root-level variables for portalled content (dialogs, dropdowns, etc.)
   
   These variables are available at :root (light) and html.dark (dark) so that
   portalled pipeline UI components (which render outside .pipeline-canvas-root)
   can access theme variables.
   
   For default white theme in any app: :root values apply.
   For dark mode in portalled components: host app should set html.dark class.
   ============================================================================ */

/* Light mode (default) - available at :root for portalled content */
:root {
  /* Core colors */
  --pc-background: 240 5% 96%;
  --pc-foreground: 222 47% 11%;
  --pc-card: 0 0% 100%;
  --pc-card-foreground: 222 47% 11%;
  --pc-popover: 0 0% 100%;
  --pc-popover-foreground: 222 47% 11%;
  
  /* Primary accent */
  --pc-primary: 221 83% 53%;
  --pc-primary-foreground: 210 40% 98%;
  
  /* Secondary */
  --pc-secondary: 210 40% 96%;
  --pc-secondary-foreground: 222 47% 11%;
  
  /* Muted */
  --pc-muted: 210 40% 96%;
  --pc-muted-foreground: 215 16% 47%;
  
  /* Accent */
  --pc-accent: 210 40% 96%;
  --pc-accent-foreground: 222 47% 11%;
  
  /* Destructive */
  --pc-destructive: 0 84% 60%;
  --pc-destructive-foreground: 210 40% 98%;
  
  /* Border & Input */
  --pc-border: 229 231 235;         /* gray-200 */
  --pc-border-strong: 209 213 219;  /* gray-300 */
  --pc-input: 209 213 219;          /* gray-300 */
  --pc-ring: 221 83% 53%;
  
  /* Radius */
  --pc-radius: 0.5rem;
  
  /* Canvas-specific */
  --pc-canvas-bg: 240 5% 96%;
  --pc-canvas-dots: 215 14% 75%;
  --pc-toolbar-bg: 0 0% 100%;
  --pc-toolbar-border: 229 231 235; /* gray-200 */
  --pc-sidebar-bg: 0 0% 100%;
  --pc-panel-bg: 0 0% 100%;
  
  /* Node colors */
  --pc-node-bg: 0 0% 100%;
  --pc-node-border: 214 32% 91%;
  --pc-node-border-pending: 220 9% 76%;
  
  /* Controls */
  --pc-controls-bg: 0 0% 100%;
  --pc-controls-border: 214 32% 91%;
  --pc-minimap-bg: 0 0% 94%;
  
  /* Status colors (consistent across themes) */
  --pc-status-running: 217 91% 60%;
  --pc-status-success: 142 71% 45%;
  --pc-status-error: 0 84% 60%;
  --pc-status-pending: 220 9% 76%;
  
  /* Text colors */
  --pc-text-primary: 222 47% 11%;
  --pc-text-secondary: 215 16% 47%;
  --pc-text-muted: 215 16% 57%;
  --pc-text-inverse: 210 40% 98%;
  
  /* Button colors */
  --pc-btn-primary-bg: 142 71% 45%;
  --pc-btn-primary-hover: 142 71% 40%;
  --pc-btn-secondary-bg: 217 19% 27%;
  --pc-btn-secondary-hover: 217 19% 35%;
  --pc-btn-danger-bg: 0 63% 31%;
  --pc-btn-danger-hover: 0 63% 40%;
}

/* Dark mode - available at html.dark for portalled content */
html.dark {
  /* Core colors */
  --pc-background: 230 25% 8%;
  --pc-foreground: 213 31% 91%;
  --pc-card: 224 50% 8%;
  --pc-card-foreground: 213 31% 91%;
  --pc-popover: 224 50% 8%;
  --pc-popover-foreground: 213 31% 91%;
  
  /* Primary accent */
  --pc-primary: 217 91% 60%;
  --pc-primary-foreground: 222 47% 11%;
  
  /* Secondary */
  --pc-secondary: 217 19% 17%;
  --pc-secondary-foreground: 210 40% 98%;
  
  /* Muted */
  --pc-muted: 217 19% 17%;
  --pc-muted-foreground: 215 16% 57%;
  
  /* Accent */
  --pc-accent: 217 19% 17%;
  --pc-accent-foreground: 210 40% 98%;
  
  /* Destructive */
  --pc-destructive: 0 63% 31%;
  --pc-destructive-foreground: 210 40% 98%;
  
  /* Border & Input */
  --pc-border: 55 65 81;            /* gray-700 */
  --pc-border-strong: 75 85 99;     /* gray-600 */
  --pc-input: 75 85 99;             /* gray-600 */
  --pc-ring: 224 64% 33%;
  
  /* Canvas-specific */
  --pc-canvas-bg: 233 25% 10%;
  --pc-canvas-dots: 217 19% 27%;
  --pc-toolbar-bg: 232 30% 12%;
  --pc-toolbar-border: 55 65 81; /* gray-700 */
  --pc-sidebar-bg: 232 30% 12%;
  --pc-panel-bg: 232 30% 12%;
  
  /* Node colors */
  --pc-node-bg: 0 0% 100%;
  --pc-node-border: 220 9% 76%;
  --pc-node-border-pending: 220 9% 76%;
  
  /* Controls */
  --pc-controls-bg: 224 50% 10%;
  --pc-controls-border: 217 19% 17%;
  --pc-minimap-bg: 224 50% 6%;
  
  /* Text colors */
  --pc-text-primary: 213 31% 91%;
  --pc-text-secondary: 215 16% 65%;
  --pc-text-muted: 215 16% 50%;
  --pc-text-inverse: 222 47% 11%;
  
  /* Button colors */
  --pc-btn-primary-bg: 142 71% 45%;
  --pc-btn-primary-hover: 142 71% 50%;
  --pc-btn-secondary-bg: 217 19% 27%;
  --pc-btn-secondary-hover: 217 19% 35%;
  --pc-btn-danger-bg: 0 63% 31%;
  --pc-btn-danger-hover: 0 63% 40%;
}

/* Base theme variables - Light mode (default) */
.pipeline-canvas-root {
  /* Core colors */
  --pc-background: 240 5% 96%;
  --pc-foreground: 222 47% 11%;
  --pc-card: 0 0% 100%;
  --pc-card-foreground: 222 47% 11%;
  --pc-popover: 0 0% 100%;
  --pc-popover-foreground: 222 47% 11%;
  
  /* Primary accent */
  --pc-primary: 221 83% 53%;
  --pc-primary-foreground: 210 40% 98%;
  
  /* Secondary */
  --pc-secondary: 210 40% 96%;
  --pc-secondary-foreground: 222 47% 11%;
  
  /* Muted */
  --pc-muted: 210 40% 96%;
  --pc-muted-foreground: 215 16% 47%;
  
  /* Accent */
  --pc-accent: 210 40% 96%;
  --pc-accent-foreground: 222 47% 11%;
  
  /* Destructive */
  --pc-destructive: 0 84% 60%;
  --pc-destructive-foreground: 210 40% 98%;
  
  /* Border & Input - Match app's gray colors */
  --pc-border: 229 231 235;         /* gray-200 - matches app border-gray-200 */
  --pc-border-strong: 209 213 219;  /* gray-300 */
  --pc-input: 209 213 219;          /* gray-300 */
  --pc-ring: 221 83% 53%;
  
  /* Radius */
  --pc-radius: 0.5rem;
  
  /* Canvas-specific */
  --pc-canvas-bg: 240 5% 96%;
  --pc-canvas-dots: 215 14% 75%;
  --pc-toolbar-bg: 0 0% 100%;
  --pc-toolbar-border: 229 231 235; /* gray-200 */
  --pc-sidebar-bg: 0 0% 100%;
  --pc-panel-bg: 0 0% 100%;
  
  /* Node colors */
  --pc-node-bg: 0 0% 100%;
  --pc-node-border: 214 32% 91%;
  --pc-node-border-pending: 220 9% 76%;
  
  /* Controls */
  --pc-controls-bg: 0 0% 100%;
  --pc-controls-border: 214 32% 91%;
  --pc-minimap-bg: 0 0% 94%;
  
  /* Status colors (consistent across themes) */
  --pc-status-running: 217 91% 60%;
  --pc-status-success: 142 71% 45%;
  --pc-status-error: 0 84% 60%;
  --pc-status-pending: 220 9% 76%;
  
  /* Text colors */
  --pc-text-primary: 222 47% 11%;
  --pc-text-secondary: 215 16% 47%;
  --pc-text-muted: 215 16% 57%;
  --pc-text-inverse: 210 40% 98%;
  
  /* Button colors */
  --pc-btn-primary-bg: 142 71% 45%;
  --pc-btn-primary-hover: 142 71% 40%;
  --pc-btn-secondary-bg: 217 19% 27%;
  --pc-btn-secondary-hover: 217 19% 35%;
  --pc-btn-danger-bg: 0 63% 31%;
  --pc-btn-danger-hover: 0 63% 40%;
}

/* Dark theme */
.pipeline-canvas-root[data-theme="dark"],
.pipeline-canvas-root.dark {
  /* Core colors */
  --pc-background: 230 25% 8%;
  --pc-foreground: 213 31% 91%;
  --pc-card: 224 50% 8%;
  --pc-card-foreground: 213 31% 91%;
  --pc-popover: 224 50% 8%;
  --pc-popover-foreground: 213 31% 91%;
  
  /* Primary accent */
  --pc-primary: 217 91% 60%;
  --pc-primary-foreground: 222 47% 11%;
  
  /* Secondary */
  --pc-secondary: 217 19% 17%;
  --pc-secondary-foreground: 210 40% 98%;
  
  /* Muted */
  --pc-muted: 217 19% 17%;
  --pc-muted-foreground: 215 16% 57%;
  
  /* Accent */
  --pc-accent: 217 19% 17%;
  --pc-accent-foreground: 210 40% 98%;
  
  /* Destructive */
  --pc-destructive: 0 63% 31%;
  --pc-destructive-foreground: 210 40% 98%;
  
  /* Border & Input - Match app's gray colors */
  --pc-border: 55 65 81;            /* gray-700 - matches app dark mode */
  --pc-border-strong: 75 85 99;     /* gray-600 */
  --pc-input: 75 85 99;             /* gray-600 */
  --pc-ring: 224 64% 33%;
  
  /* Canvas-specific */
  --pc-canvas-bg: 233 25% 10%;
  --pc-canvas-dots: 217 19% 27%;
  --pc-toolbar-bg: 232 30% 12%;
  --pc-toolbar-border: 55 65 81; /* gray-700 */
  --pc-sidebar-bg: 232 30% 12%;
  --pc-panel-bg: 232 30% 12%;
  
  /* Node colors */
  --pc-node-bg: 0 0% 100%;
  --pc-node-border: 220 9% 76%;
  --pc-node-border-pending: 220 9% 76%;
  
  /* Controls */
  --pc-controls-bg: 224 50% 10%;
  --pc-controls-border: 217 19% 17%;
  --pc-minimap-bg: 224 50% 6%;
  
  /* Text colors */
  --pc-text-primary: 213 31% 91%;
  --pc-text-secondary: 215 16% 65%;
  --pc-text-muted: 215 16% 50%;
  --pc-text-inverse: 222 47% 11%;
  
  /* Button colors */
  --pc-btn-primary-bg: 142 71% 45%;
  --pc-btn-primary-hover: 142 71% 50%;
  --pc-btn-secondary-bg: 217 19% 27%;
  --pc-btn-secondary-hover: 217 19% 35%;
  --pc-btn-danger-bg: 0 63% 31%;
  --pc-btn-danger-hover: 0 63% 40%;
}

/* ============================================================================
   Base Styles
   ============================================================================ */

.pipeline-canvas-root {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  color: hsl(var(--pc-foreground));
  height: 100%;
  width: 100%;
}

.pipeline-canvas-container {
  width: 100%;
  height: 100%;
}

/* ============================================================================
   Node Configuration Panel - Solid Backgrounds
   ============================================================================ */

/* Light mode - White backgrounds */
.pipeline-canvas-root [class*="bg-[hsl(var(--pc-panel-bg))"] {
  background-color: #ffffff !important;
}

.pipeline-canvas-root [class*="bg-[hsl(var(--pc-sidebar-bg))"] {
  background-color: #ffffff !important;
}

.pipeline-canvas-root [class*="bg-[hsl(var(--pc-toolbar-bg))"] {
  background-color: #f8fafc !important;
}

/* Dark mode - Dark backgrounds */
.pipeline-canvas-root[data-theme="dark"] [class*="bg-[hsl(var(--pc-panel-bg))"],
.pipeline-canvas-root.dark [class*="bg-[hsl(var(--pc-panel-bg))"] {
  background-color: #1e1e2e !important;
}

.pipeline-canvas-root[data-theme="dark"] [class*="bg-[hsl(var(--pc-sidebar-bg))"],
.pipeline-canvas-root.dark [class*="bg-[hsl(var(--pc-sidebar-bg))"] {
  background-color: #1a1a2e !important;
}

.pipeline-canvas-root[data-theme="dark"] [class*="bg-[hsl(var(--pc-toolbar-bg))"],
.pipeline-canvas-root.dark [class*="bg-[hsl(var(--pc-toolbar-bg))"] {
  background-color: #252540 !important;
}

/* ============================================================================
   React Flow Overrides (Scoped)
   ============================================================================ */

.pipeline-canvas-root .react-flow {
  background-color: hsl(var(--pc-canvas-bg));
}

.pipeline-canvas-root .react-flow__background {
  background-color: hsl(var(--pc-canvas-bg));
}

.pipeline-canvas-root .react-flow__minimap {
  background-color: hsl(var(--pc-minimap-bg));
  border-radius: 0.5rem;
}

.pipeline-canvas-root .react-flow__controls {
  background-color: hsl(var(--pc-controls-bg));
  border: 1px solid hsl(var(--pc-controls-border));
  border-radius: 0.5rem;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

.pipeline-canvas-root .react-flow__controls-button {
  background-color: hsl(var(--pc-controls-bg));
  border-color: hsl(var(--pc-controls-border));
  color: hsl(var(--pc-foreground));
  width: 28px;
  height: 28px;
}

.pipeline-canvas-root .react-flow__controls-button:hover {
  background-color: hsl(var(--pc-muted));
}

.pipeline-canvas-root .react-flow__controls-button svg {
  fill: currentColor;
}

/* ============================================================================
   Utility Classes (Scoped)
   ============================================================================ */

/* Background utilities - Solid colors */
.pc-bg-canvas { background-color: hsl(var(--pc-canvas-bg)); }
.pc-bg-toolbar { background-color: hsl(var(--pc-toolbar-bg)); }
.pc-bg-sidebar { background-color: hsl(var(--pc-sidebar-bg)); }
.pc-bg-panel { 
  /* Use CSS variable with fallback for portalled content */
  background-color: hsl(var(--pc-panel-bg, 0 0% 100%));
}
html.dark .pc-bg-panel,
.dark .pc-bg-panel {
  /* Use CSS variable with fallback for portalled content */
  background-color: hsl(var(--pc-panel-bg, 232 30% 12%));
}
.pc-bg-card { background-color: hsl(var(--pc-card)); }
.pc-bg-muted { background-color: hsl(var(--pc-muted)); }
.pc-bg-accent { background-color: hsl(var(--pc-accent)); }
.pc-bg-background { background-color: hsl(var(--pc-background)); }
.pc-bg-popover { background-color: hsl(var(--pc-popover)); }

/* Solid background overrides for node config panel */
.pc-bg-panel-solid {
  background-color: #ffffff;
}

.pc-bg-sidebar-solid {
  background-color: #ffffff;
}

.pc-bg-toolbar-solid {
  background-color: #f8fafc;
}

.pipeline-canvas-root[data-theme="dark"] .pc-bg-panel-solid,
.pipeline-canvas-root.dark .pc-bg-panel-solid {
  background-color: #1e1e2e;
}

.pipeline-canvas-root[data-theme="dark"] .pc-bg-sidebar-solid,
.pipeline-canvas-root.dark .pc-bg-sidebar-solid {
  background-color: #1a1a2e;
}

.pipeline-canvas-root[data-theme="dark"] .pc-bg-toolbar-solid,
.pipeline-canvas-root.dark .pc-bg-toolbar-solid {
  background-color: #252540;
}

/* Dialog background fix for portalled content - ensure opaque background */
/* Set CSS variable at root for light theme */
:root {
  --dialog-bg-light: #ffffff;
  --dialog-bg-dark: #1e1e2e;
}

/* Light theme (default) - must come first and be very specific */
[data-radix-portal] > div[role="dialog"],
div[role="dialog"][data-state],
div[role="dialog"],
[data-radix-dialog-content] {
  background-color: var(--dialog-bg-light, #ffffff) !important;
  opacity: 1 !important;
  backdrop-filter: none !important;
}

/* Dark theme - override light theme with higher specificity */
html.dark [data-radix-portal] > div[role="dialog"],
html.dark div[role="dialog"][data-state],
html.dark div[role="dialog"],
html.dark [data-radix-dialog-content],
.dark [data-radix-portal] > div[role="dialog"],
.dark div[role="dialog"][data-state],
.dark div[role="dialog"],
.dark [data-radix-dialog-content] {
  background-color: var(--dialog-bg-dark, #1e1e2e) !important;
  opacity: 1 !important;
  backdrop-filter: none !important;
}

/* Text utilities */
.pc-text-primary { color: hsl(var(--pc-text-primary)); }
.pc-text-secondary { color: hsl(var(--pc-text-secondary)); }
.pc-text-muted { color: hsl(var(--pc-text-muted)); }
.pc-text-inverse { color: hsl(var(--pc-text-inverse)); }
.pc-text-foreground { color: hsl(var(--pc-foreground)); }
.pc-text-accent { color: hsl(var(--pc-accent-foreground)); }

/* Border utilities */
.pc-border { border-color: rgb(var(--pc-border)); }
.pc-border-toolbar { border-color: rgb(var(--pc-toolbar-border)); }
.pc-border-input { border-color: rgb(var(--pc-input)); }

/* Ring utilities */
.pc-ring-offset-background { --tw-ring-offset-color: hsl(var(--pc-background)); }
.pc-ring { --tw-ring-color: hsl(var(--pc-ring)); }

/* Primary color utilities */
.pc-bg-primary { background-color: hsl(var(--pc-primary)); }
.pc-text-primary-color { color: hsl(var(--pc-primary)); }
.pc-text-primary-foreground { color: hsl(var(--pc-primary-foreground)); }

/* Destructive color utilities */
.pc-bg-destructive { background-color: hsl(var(--pc-destructive)); }
.pc-text-destructive { color: hsl(var(--pc-destructive)); }
.pc-text-destructive-foreground { color: hsl(var(--pc-destructive-foreground)); }

/* Status indicator colors */
.pc-status-running { color: hsl(var(--pc-status-running)); }
.pc-status-success { color: hsl(var(--pc-status-success)); }
.pc-status-error { color: hsl(var(--pc-status-error)); }

/* ============================================================================
   Component-Specific Styles
   ============================================================================ */

/* Theme toggle button */
.pc-theme-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem;
  border-radius: 0.375rem;
  background-color: hsl(var(--pc-muted));
  color: hsl(var(--pc-foreground));
  border: 1px solid rgb(var(--pc-border));
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s;
}

.pc-theme-toggle:hover {
  background-color: hsl(var(--pc-accent));
}

/* Animations */
@keyframes pc-pulse-glow {
  0%, 100% {
    box-shadow: 0 0 5px hsl(var(--pc-status-running) / 0.5);
  }
  50% {
    box-shadow: 0 0 20px hsl(var(--pc-status-running) / 0.8);
  }
}

.animate-pulse-glow {
  animation: pc-pulse-glow 2s ease-in-out infinite;
}

/* Scrollbar styling (dark theme) */
.pipeline-canvas-root[data-theme="dark"] ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.pipeline-canvas-root[data-theme="dark"] ::-webkit-scrollbar-track {
  background: hsl(var(--pc-background));
}

.pipeline-canvas-root[data-theme="dark"] ::-webkit-scrollbar-thumb {
  background: hsl(var(--pc-muted));
  border-radius: 4px;
}

.pipeline-canvas-root[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--pc-muted-foreground));
}

/* Scrollbar styling (light theme) */
.pipeline-canvas-root[data-theme="light"] ::-webkit-scrollbar,
.pipeline-canvas-root:not([data-theme="dark"]) ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.pipeline-canvas-root[data-theme="light"] ::-webkit-scrollbar-track,
.pipeline-canvas-root:not([data-theme="dark"]) ::-webkit-scrollbar-track {
  background: hsl(var(--pc-muted));
}

.pipeline-canvas-root[data-theme="light"] ::-webkit-scrollbar-thumb,
.pipeline-canvas-root:not([data-theme="dark"]) ::-webkit-scrollbar-thumb {
  background: hsl(var(--pc-muted-foreground));
  border-radius: 4px;
}
